websocket = (wsurl, msg) {
    url = "https://http-ws.seven7four4.repl.co/ws"
    body = '{"url":"{}","message":"{}"}'.fmt([wsurl, msg])
    method = "post"
    headers = {
        "Content-Type": "application/json",
    }
    return $.http_request(method, url, headers, body).text
}

MarebolDB = (id) {
	let websocket = import spwn_ws
	let funcs = {
		get: (v) {
			let json = websocket("wss://" + id + ".id.repl.co/api", "/get " + v)
			return json
		},
		set: (v1, v2) {
			let json = websocket("wss://" + id + ".id.repl.co/api", "/set " + v1 + " " + v2)
			return json
		},
		delete: (v) {
			let json = websocket("wss://" + id + ".id.repl.co/api", "/delete " + v1)
			return json
		},
		listall: (){
			let json = websocket("wss://" + id + ".id.repl.co/api", "/listall")
			return json
		}
	}
	return funcs
}

return MarebolDB
